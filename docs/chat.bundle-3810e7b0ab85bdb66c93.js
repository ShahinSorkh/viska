(window.webpackJsonp=window.webpackJsonp||[]).push([[2],{22:function(t,e,n){"use strict";n.d(e,"a",(function(){return o})),n.d(e,"b",(function(){return a}));var r=n(23),i=n.n(r),o={"~x(":"at-wits-end.gif","x(":"angry-or-grumpy.gif",";;)":"batting-eyelashes.gif",">:d<":"big-hug.gif",'=">':"blushing.gif","=((":"broken-heart.gif",":-/":"confused.gif","b-)":"sunglasses-or-cool.gif",":((":"crying.gif","8->":"daydreaming.gif",">:)":"devil.gif",":-$":"do-not-tell-anyone.gif","#-o":"doh!.gif","=p~":"drooling.gif",x_x:"i-do-not-want-to-see.gif",":-*":"kiss.gif",":))":"laughing.gif",":x":"love-struck.gif",":-ss":"nail-biting.gif",":-b":"nerd.gif","[-(":"not-talking.gif",":)]":"on-the-phone.gif","<:-p":"party.gif",">:p":"phbbbbt-or-upset.gif","/:)":"raised-eyebrow.gif","8-|":"rolling-eyes.gif",":-w":"waiting.gif",":-h":"wave.gif","#:-s":"whew.gif",";)":"winking.gif",":-s":"worried.gif","(:|":"yawn.gif",">-)":"alien.gif","b-(":"beat-up.gif",":-@":"chatterbox.gif",":-??":"confused-or-i-don't-know.gif","\\:d/":"dancing.gif",":-l":"frustrated.gif",";))":"giggle-or-hee-hee.gif","%-(":"not-listening.gif",':-"':"whistling.gif",":(":"sad-or-frown-face.gif","=))":"rolling-on-the-floor-laughing.gif",":&":"sick.gif",":-<":"sigh.gif","|-)":"sleepy.gif",":)":"smile-or-happy-face.gif",":>":"smug.gif",":p":"frustrated-or-sticking-tongue-out.gif",":|":"straight-face.gif",":o":"surprised.gif",":-?":"thinking.gif",":d":"big-grin.gif"},s=Object.keys(o),a=function(t){for(var e=t||"",n=0;n<s.length;n++)for(var r=s[n],a=o[r],c=i()(r),u='<img src="/emoticons/'.concat(a,'" />');e.includes(c);)e=e.replace(c,u);return e}},63:function(t,e){},7:function(t,e,n){"use strict";n.r(e);var r=n(38),i=n.n(r),o=n(22),s=n(67);function a(t){return function(t){if(Array.isArray(t))return c(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return c(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return c(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function c(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var u=function(t){var e=t.name,n=void 0===e?"db":e,r=t.version,i=void 0===r?1:r,o=t.prefix,c=void 0===o?"prefix":o,u=t.dynamicCollections,f=void 0===u?[]:u,h=t.staticCollections,g=void 0===h?[]:h,l=[].concat(a(f),a(g)),d=function(t){return f.includes(t)},m=new Promise((function(t){Object(s.a)(n,i,{upgrade:function(t){l.forEach((function(e){t.objectStoreNames.contains(e)||t.createObjectStore(e)}))}}).then(t).catch((function(){t({get:function(t,e){var r=localStorage.getItem("".concat(n,"@").concat(i,":").concat(t,".").concat(e));return Promise.resolve(r?JSON.parse(r):void 0)},put:function(t,e,r){return localStorage.setItem("".concat(n,"@").concat(i,":").concat(t,".").concat(r),JSON.stringify(e)),Promise.resolve()},clear:function(t,e){return localStorage.removeItem("".concat(n,"@").concat(i,":").concat(t,".").concat(e)),Promise.resolve()}})}))})),p={};return l.forEach((function(t){p[t]=function(t){return{get:function(){return m.then((function(e){return e.get(t,d(t)?c:"root")}))},set:function(e){return m.then((function(n){return n.put(t,e,d(t)?c:"root")}))},clear:function(){return m.then((function(e){return e.clear(t,d(t)?c:"root")}))}}}(t)})),p};function f(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function h(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function g(t){return function(t){if(Array.isArray(t))return l(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return l(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return l(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function l(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var d=function(t,e){return{type:t,username:e}},m={data:function(){return{user:d(),sid:void 0,server:void 0,chats:[],db:null,_refreshChatsLoopTimeout:null}},methods:{init:function(t){this.server=i()(t,{autoConnect:!1}),this.server.on("connect",this._onConnectionStateChange.bind(this,!0)),this.server.on("disconnect",this._onConnectionStateChange.bind(this,!1)),this.server.on("newMessage",this._onNewMessage),this.server.on("isTypingFlag",this._onIsTypingFlag),this.server.on("connetedToRandomUser",this._onConnetedToRandomUser),this.server.open(),this.startRefreshChatsLoop()},login:function(t){var e=this;return new Promise((function(n,r){e.server.emit("auth",t,(function(t,i){t?r(t):(e.user=d(i.type,i.username),e.db=u({name:"viska",version:2,prefix:"temporary"===e.user.type?"!anonymous":"@".concat(e.user.username),dynamicCollections:["chats"],staticCollections:["settings"]}),e._loadChats().then((function(){e.$emit("login",i.type,i.username),setTimeout((function(){e.server.emit("askForPendingMessages",(function(){}))})),n()})))}))}))},logout:function(){var t=this;this._saveChats().then((function(){t.chats=[],t.user=d(),t.$emit("logout"),setTimeout((function(){location.reload()}),100)}))},connectToRandomUser:function(){var t=this;return new Promise((function(e,n){t.server.emit("connectToRandomUser",(function(r,i){r||!i?n(r):t.getChat(i.type,i.username).then((function(t){e(t)}))}))}))},cancelConnectToRandomUser:function(){var t=this;return new Promise((function(e){t.server.emit("cancelConnectToRandomUser",(function(t){e()}))}))},_onConnetedToRandomUser:function(t){var e=this,n=t.type,r=t.username;this.getChat(n,r).then((function(t){e.$emit("connetedToRandomUser",t)}))},addMessageToChat:function(t,e){t.messages.push(e);var n=this.chats.indexOf(t);return this.chats=[t].concat(g(this.chats.slice(0,n)),g(this.chats.slice(n+1))),this._saveChats()},editChat:function(t,e){return Object.keys(e).forEach((function(n){t[n]=e[n]})),this._saveChats()},sendMessage:function(t,e){var n=this;return new Promise((function(r,i){n.server.emit("sendMessage",{user:t.user,body:e},(function(e,s){e&&i(e),n.addMessageToChat(t,{from:"me",body:Object(o.b)(s.body),date:s.date}).then(r)}))}))},_onNewMessage:function(t){var e=this,n=t.from,r=n.type,i=n.username,s=t.body,a=t.date;this.getChat(r,i,!1).then((function(t){t.isOnline=!0,e.addMessageToChat(t,{from:"its",body:Object(o.b)(s),date:a}).then((function(){e.$emit("newMessage",{user:d(r,i),body:s,date:a})}))}))},sendIsTypingFlag:function(t){var e=this;return new Promise((function(n,r){e.server.emit("sendIsTypingFlag",{user:{type:t.user.type,username:t.user.username}},(function(t){t?r():n()}))}))},_onIsTypingFlag:function(t){this.$emit("isTypingFlag",t)},deleteChat:function(t){return this.chats.splice(this.chats.indexOf(t),1),this._saveChats()},refreshChat:function(t){var e=this;return new Promise((function(n){e.server.emit("getUserStatus",t.user,(function(e,r){t.isOnline=!e&&r,n(t.isOnline)}))}))},startRefreshChatsLoop:function(){var t=this;clearTimeout(this._refreshChatsLoopTimeout),this.chats.forEach((function(e){t.refreshChat(e)})),this._refreshChatsLoopTimeout=setTimeout((function(){t.startRefreshChatsLoop()}),1e4)},_saveChats:function(){var t=this;return new Promise((function(e){t.db?setTimeout((function(){var n=t.chats.map((function(e){return"temporary"===t.user.type?function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?f(Object(n),!0).forEach((function(e){h(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):f(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}({},e,{messages:[]}):e}));t.db.chats.set(n).then(e)})):e()}))},_loadChats:function(){var t=this;return new Promise((function(e){t.db?t.db.chats.get().then((function(n){t.chats=(n||[]).map((function(t){return t.isOnline=null,t})),e(),t.startRefreshChatsLoop()})):(t.chats=[],e())}))},_clearChats:function(){this.chats=[]},_onConnectionStateChange:function(t){!0===t?(this.sid=this.server.id,this.$emit("connect",this.sid)):(location.reload(),this.$emit("disconnect"))},getChat:function(t,e){var n=this,r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return new Promise((function(i){var o=n.chats.find((function(n){return n.user.type===t&&n.user.username===e}));o||(o={user:d(t,e),isOnline:null,messages:[],badge:0},n.chats.unshift(o)),r?n._saveChats().then((function(){i(o)})):i(o)}))}}};e.default=m}}]);